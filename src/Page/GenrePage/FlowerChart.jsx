import React, { useRef, useEffect, useState } from "react";
import * as d3 from "d3";
import { selectAll } from "d3";

const paths = [
  "M1 29.7119C16.4196 8.04525 56.907 -22.2881 95.5 29.7119C80.0804 51.3786 39.593 81.7119 1 29.7119Z",
  "M1 29.7119C16.4196 8.04525 56.907 -22.2881 95.5 29.7119C80.0804 51.3786 39.593 81.7119 1 29.7119Z",
  "M1 29.7119C19.683 8.04525 68.7392 -22.2881 115.5 29.7119C96.817 51.3786 47.7608 81.7119 1 29.7119Z",
  "M1 29.7119C19.683 8.04525 68.7392 -22.2881 115.5 29.7119C96.817 51.3786 47.7608 81.7119 1 29.7119Z",
  "M1 29.7119C22.9464 8.04525 80.5713 -22.2881 135.5 29.7119C113.554 51.3786 55.9287 81.7119 1 29.7119Z",
  "M1 29.7119C22.9464 8.04525 80.5713 -22.2881 135.5 29.7119C113.554 51.3786 55.9287 81.7119 1 29.7119Z",
  "M1 29.7119C26.2098 8.04525 92.4035 -22.2881 155.5 29.7119C130.29 51.3786 64.0965 81.7119 1 29.7119Z",
  "M1 29.7119C26.2098 8.04525 92.4035 -22.2881 155.5 29.7119C130.29 51.3786 64.0965 81.7119 1 29.7119Z",
  "M1 29.7119C29.4732 8.04525 104.236 -22.2881 175.5 29.7119C147.027 51.3786 72.2643 81.7119 1 29.7119Z",
  "M1 29.7119C29.4732 8.04525 104.236 -22.2881 175.5 29.7119C147.027 51.3786 72.2643 81.7119 1 29.7119Z",
  "M1 29.7119C32.7366 8.04525 116.068 -22.2881 195.5 29.7119C163.763 51.3786 80.4322 81.7119 1 29.7119Z",
  "M1 29.7119C32.7366 8.04525 116.068 -22.2881 195.5 29.7119C163.763 51.3786 80.4322 81.7119 1 29.7119Z",
  "M1 29.7119C36 8.04525 127.9 -22.2881 215.5 29.7119C180.5 51.3786 88.6 81.7119 1 29.7119Z",
  "M1 29.7119C36 8.04525 127.9 -22.2881 215.5 29.7119C180.5 51.3786 88.6 81.7119 1 29.7119Z",
  "M1 29.71C40.2634 8.04479 140.732 -22.2866 236.5 29.71C198.237 51.3753 97.7678 81.7066 1 29.71Z",
  "M1 29.71C40.2634 8.04479 140.732 -22.2866 236.5 29.71C198.237 51.3753 97.7678 81.7066 1 29.71Z",
  "M1 29.71C43.5268 8.04479 152.564 -22.2866 256.5 29.71C214.973 51.3753 105.936 81.7066 1 29.71Z",
  "M1 29.71C43.5268 8.04479 152.564 -22.2866 256.5 29.71C214.973 51.3753 105.936 81.7066 1 29.71Z",
  "M1 29.71C46.7902 8.04479 164.397 -22.2866 276.5 29.71C231.71 51.3753 114.104 81.7066 1 29.71Z",
  "M1 29.71C46.7902 8.04479 164.397 -22.2866 276.5 29.71C231.71 51.3753 114.104 81.7066 1 29.71Z",
  "M1 29.71C50.0536 8.04479 176.229 -22.2866 296.5 29.71C248.446 51.3753 122.271 81.7066 1 29.71Z",
  "M1 29.71C50.0536 8.04479 176.229 -22.2866 296.5 29.71C248.446 51.3753 122.271 81.7066 1 29.71Z",
  "M1 29.71C53.317 8.04479 188.061 -22.2866 316.5 29.71C265.183 51.3753 130.439 81.7066 1 29.71Z",
  "M1 29.71C53.317 8.04479 188.061 -22.2866 316.5 29.71C265.183 51.3753 130.439 81.7066 1 29.71Z",
  "M1 29.71C56.5804 8.04479 199.893 -22.2866 336.5 29.71C281.92 51.3753 138.607 81.7066 1 29.71Z",
  "M1 29.71C56.5804 8.04479 199.893 -22.2866 336.5 29.71C281.92 51.3753 138.607 81.7066 1 29.71Z",
  "M1 29.71C59.8438 8.04479 211.725 -22.2866 356.5 29.71C298.656 51.3753 146.775 81.7066 1 29.71Z",
  "M1 29.71C59.8438 8.04479 211.725 -22.2866 356.5 29.71C298.656 51.3753 146.775 81.7066 1 29.71Z",
  "M1 29.71C63.1072 8.04479 223.557 -22.2866 376.5 29.71C315.393 51.3753 154.943 81.7066 1 29.71Z",
  "M1 29.71C63.1072 8.04479 223.557 -22.2866 376.5 29.71C315.393 51.3753 154.943 81.7066 1 29.71Z",
  "M1 29.71C66.3706 8.04479 235.39 -22.2866 396.5 29.71C332.129 51.3753 163.11 81.7066 1 29.71Z",
  "M1 29.71C66.3706 8.04479 235.39 -22.2866 396.5 29.71C332.129 51.3753 163.11 81.7066 1 29.71Z",
  "M1 29.71C69.634 8.04479 247.222 -22.2866 416.5 29.71C348.866 51.3753 171.278 81.7066 1 29.71Z",
  "M1 29.71C69.634 8.04479 247.222 -22.2866 416.5 29.71C348.866 51.3753 171.278 81.7066 1 29.71Z",
  "M1 29.71C72.8974 8.04479 259.054 -22.2866 436.5 29.71C365.603 51.3753 179.446 81.7066 1 29.71Z",
];

let years = [
  2022, 2021, 2020, 2019, 2018, 2017, 2016, 2015, 2014, 2013, 2012, 2011, 2010,
  2009, 2008, 2007, 2006, 2005, 2004, 2003, 2002, 2001, 2000,
];

const FlowerChart = ({ data, genreColorGenerator }) => {
  const ref = useRef(null);

  useEffect(() => {
    const svg = d3.select(ref.current);
    const height = ref.current.clientHeight;
    const width = ref.current.clientWidth;

    let flowers = svg
      .append("g")
      .attr("id", "flower")
      .attr("transform", `translate(${width / 2.5},${height / 1.8})`);

    flowers
      .selectAll("path")
      .data(data.types)
      .enter()
      .append("path")
      .attr("d", (d, i) => paths[d.counts - 1])
      .attr(
        "transform",
        (d, i) => `rotate(${d.angle},0,${29.71 * 0.3}) scale(0.3)`
      )
      .style("fill", (d) => genreColorGenerator(d.type))
      .attr("opacity", 0.5);

    svg
      .append("text")
      .attr("x", width / 2.875)
      .attr("y", 15)
      .attr("fill", "white")
      .style("font-size", "10px")
      .style('font-weight','bold')
      .text(data.year)
      .attr("opacity", 0.5);

    svg
      .append("circle")
      .attr("cx", width / 2.5)
      .attr("cy", height / 1.8)
      .attr("r", 45)
      .attr("fill", "none")
      .attr("stroke", "white")
      .attr("stroke-width", 1)
      .attr("stroke-dasharray", 0.5)
      .attr("opacity", 0.1);

    svg
      .append("circle")
      .attr("cx", width / 2.5)
      .attr("cy", height / 1.8)
      .attr("r", 60)
      .attr("fill", "none")
      .attr("stroke", "white")
      .attr("stroke-width", 1)
      .attr("stroke-dasharray", 0.1)
      .attr("opacity", 0.1);
  }, [ref.current]);

  return <svg className="w-full h-full" ref={ref}></svg>;
};

export default FlowerChart;
